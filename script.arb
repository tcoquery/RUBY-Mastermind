class String
  def bg_red;         "\e[41m#{self}\e[0m" end
  def bg_green;       "\e[42m#{self}\e[0m" end
  def bg_brown;       "\e[43m#{self}\e[0m" end
  def bg_blue;        "\e[44m#{self}\e[0m" end
  def bg_magenta;     "\e[45m#{self}\e[0m" end
  def bg_cyan;        "\e[46m#{self}\e[0m" end
end

class Game < String

  def initialize
    banner
    rules
    @colors = ["1", "2", "3", "4", "5", "6"].shuffle
    @remaining_combination = []
    @remaining_numbers = []
    @clues = []
    @game_over = false
    @turn = 0
    play
  end

  def banner
    puts "========================="
    puts "=======MASTERMIND========"
    puts "=========================\n\n"
  end

  def rules
    puts "The objective is to find the correct color and order combination"
    puts "There are six colors : Red(1), Green(2), Blue(3), Yellow(4), Pink(5) \nand Orange(6)"
    puts "The combination is made up of four colors, each color can be present more \nthan once"
    puts "Each round, you get a clue, White (W) if you found a correct color but in \nthe wrong position. Black (B) if you found a color in the right position "
  end

  def play
    check_endgame
    if @game_over
      return
    else
    round
    end
  end

  def round
    puts "\nTurn ##{@turn} please make your guess"
    @user_guess = gets.chomp
      if @user_guess.match?(/^[1-6][1-6][1-6][1-6]$/)
        check_correct_position(@user_guess.split(""))
        check_wrong_position
        play
      else
        error
      end
  end

  def check_correct_position(user_guess)
    @combined_combinations = @colors[0..3].zip(user_guess)
      @combined_combinations.each_with_index do |array, index| 
      if array[0]==array[1]
        @clues.push("B")
      else
        @remaining_numbers = @remaining_numbers.push(user_guess[index])
        @remaining_combination = @remaining_combination.push(@colors[index])
      end
    end
  end

  def check_wrong_position
    @remaining_numbers.each do |number|
      if @remaining_combination.include?(number)
        @clues.push("W")
        @remaining_combination.delete(number)
      end
    end
    p @clues.join
  end

  def check_endgame
    if @clues.join == "BBBB"
      @game_over = true
      puts "Congratulations, you won !"
    elsif @turn > 11
      @game_over = true
      puts "You lost. The correct combination was #{@colors[0..3].join}."
    else
      @clues.clear
      @remaining_numbers.clear
      @remaining_combination.clear
      @turn +=1 
      
    end
  end

  def error
    puts "Erroneous input! Try again..."
    round
  end


end

Game.new