class String
  def bg_red;         "\e[41m#{self}\e[0m" end
  def bg_green;       "\e[42m#{self}\e[0m" end
  def bg_brown;       "\e[43m#{self}\e[0m" end
  def bg_blue;        "\e[44m#{self}\e[0m" end
  def bg_magenta;     "\e[45m#{self}\e[0m" end
  def bg_cyan;        "\e[46m#{self}\e[0m" end
end

class Game < String

  def initialize
    banner
    rules
    @colors = ["1", "2", "3", "4", "5", "6"]
    @colors_shuffled = @colors.shuffle
    @remaining_combination = []
    @remaining_numbers = []
    @clues = []
    @turn = 1
    play
  end

  def banner
    puts "========================="
    puts "=======MASTERMIND========"
    puts "=========================\n\n"
  end

  def rules
    puts "The objective is to find the correct color and order combination"
    puts "There are six colors : Red(1), Green(2), Blue(3), Yellow(4), Pink(5) \n and Orange(6)"
    puts "The combination is made up of four colors, each color can be present more \n than once"
    puts " "
  end

  def play
    round
  end

  def round
    puts "\nTurn ##{@turn} please make your guess"
    @user_guess = gets.chomp
      if @user_guess.match?(/^[1-6][1-6][1-6][1-6]$/)
        check_correct_position(@user_guess.split(""))
        check_wrong_position
        @turn += 1
        check_endgame
      else
        error
      end
  end

  def check_correct_position(user_guess)
    @combined_combinations = @colors_shuffled[0..3].zip(user_guess)
      @combined_combinations.each_with_index do |array, index| 
      if array[0]==array[1]
        @clues.push("B")
      else
        @remaining_numbers = @remaining_numbers.push(user_guess[index])
        @remaining_combination = @remaining_combination.push(@colors_shuffled[index])
      end
    end
  end

  def check_wrong_position
    @remaining_numbers.each do |number|
      if @remaining_combination.include?(number)
        @clues.push("W")
        @remaining_combination.delete(number)
      end
    end
    p @clues.join
    @clues.clear
    @remaining_numbers.clear
    @remaining_combination.clear
  end

  def check_endgame
    if @turn > 12
      puts "You lost."
      puts @colors_shuffled
    elsif @clues.join == "BBBB"
      puts "Congratulations, you won !"
    else
      play
    end
  end

  def error
    puts "Erroneous input! Try again..."
    round
  end


end

Game.new